---
stepsCompleted: [1, 2]
inputDocuments:
  - _bmad-output/req-market-data-mgmt.md
date: 2026-02-26
author: wallace
---

# Product Brief: 行情数据管理功能

## 执行摘要

backquant 项目新增"行情数据管理"功能模块，为 RQAlpha 行情数据包（bundle）提供可视化管理界面。该功能解决了当前数据管理完全依赖 Docker 自动化和 crontab 定时任务、缺乏可视化监控和手动控制的问题。通过数据全景、手动下载和下载配置三个子模块，用户可以实时查看数据状态、灵活控制更新流程、监控定时任务运行情况，显著提升数据管理的透明度和可控性。

---

## 核心愿景

### 问题陈述

当前 backquant 项目的 RQAlpha 行情数据包管理存在以下痛点：

1. **缺乏可见性**：用户无法查看当前数据状态（下载时间、文件数量、数据条数、最近修改时间等）
2. **缺乏控制力**：数据更新完全依赖 Docker 镜像首次安装和 crontab 定时任务，用户无法手动触发更新
3. **缺乏透明度**：下载和解压过程在后台进行，用户无法了解进度和状态
4. **配置不便**：crontab 定时任务配置需要修改容器配置，缺乏可视化管理界面
5. **日志缺失**：定时任务运行情况无法追溯，问题排查困难

### 问题影响

- **运维效率低**：需要进入容器查看文件系统才能了解数据状态
- **用户体验差**：数据更新过程不透明，用户不知道何时完成
- **问题排查难**：缺乏日志记录，定时任务失败无法及时发现
- **灵活性差**：无法根据需要手动触发数据更新

### 现有解决方案的不足

当前方案：
- Docker 镜像首次安装时自动下载 bundle
- crontab 定时任务每月第一天自动更新

不足之处：
- 完全自动化，缺乏人工干预能力
- 无可视化界面，数据状态不透明
- 无进度显示，用户体验差
- 配置修改需要重新构建镜像或修改容器配置

### 解决方案

新增"行情数据管理"功能模块，位于导航栏"研究工作台"后面，包含三个子页面：

#### 1. 数据全景
- 展示数据下载时间、总文件数、总大小、最近修改时间
- 统计各类行情数据条数（股票、基金、期货、指数等）
- 后端使用 rqalpha 库解析 bundle 目录，统计数据写入数据库
- 提供手动触发分析按钮
- 解压后自动触发数据分析

#### 2. 手动下载
- **增量更新**：使用 `rqalpha update-bundle` 命令，数据追加到现有 bundle
  - 检测本地文件修改时间，当月文件需用户确认后才下载
  - 显示下载进度条（参考全量下载接口实现）
  - 完成后自动触发数据分析

- **全量下载**：复用首次安装流程
  - 检测本地文件修改时间，当月文件需用户确认后才下载
  - 显示下载进度条
  - 显示解压进度条
  - 完成后自动触发数据分析

#### 3. 下载配置
- 可视化配置 crontab 定时任务（替代镜像中的 crontab）
- 显示和记录运行日志
- 任务完成后自动触发数据分析

### 关键技术要点

- **Bundle 路径**：沿用现有配置
  - 容器内：`/data/rqalpha/bundle`（环境变量 `RQALPHA_BUNDLE_PATH`）
  - 宿主机：Docker named volume `rqalpha_bundle`

- **数据分析触发方式**：
  - 自动触发：解压完成后
  - 手动触发：数据全景页面按钮

- **下载策略**：
  - 增量：`rqalpha update-bundle`，数据追加
  - 全量：下载 + 解压，复用首次安装流程

- **进度显示**：
  - 下载进度条（增量和全量）
  - 解压进度条（仅全量）
  - 增量下载若无进度接口，参考全量下载接口实现

- **定时任务**：
  - 可视化 cron 配置
  - 日志记录和显示
  - 任务结束触发数据分析

### 非功能性约束

- **非回归要求**：不影响现有功能
  - 登录功能
  - 回测工作台
  - 研究工作台
  - 后端逻辑
